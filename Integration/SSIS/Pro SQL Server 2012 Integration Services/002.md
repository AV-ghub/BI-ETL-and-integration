## Обзор: Pro SQL Server 2012 Integration Services (главы 5–8)

### **Глава 5: Основы потока управления**

**Ключевые понятия:**
- **Поток управления** — это последовательность задач в пакете SSIS.
- **Ограничения очередности** определяют порядок выполнения задач (Success, Completion, Failure).
- **Контейнеры** группируют задачи для лучшей организации (например, Sequence Container).
- **Точки останова** помогают отлаживать выполнение пакета.

**Основные задачи:**
1. **Data Flow Task** — сердце ETL, перемещает и преобразует данные.
2. **Execute SQL Task** — выполняет SQL-запросы и хранимые процедуры.
3. **File System Task** — работает с файлами и папками.
4. **FTP Task** — передаёт файлы по FTP.
5. **Send Mail Task** — отправляет email-уведомления.
6. **Script Task** — позволяет писать собственный код на C# или VB.NET.
7. **Execute Process Task** — запускает внешние программы.
8. **Web Service Task** — вызывает методы веб-служб.
9. **XML Task** — обрабатывает XML-данные.
10. **Data Profiling Task** — анализирует качество данных.
11. **Execute Package Task** — запускает другие пакеты (родительско-дочерняя архитектура).
12. **Bulk Insert Task** — быстро загружает большие объёмы данных в SQL Server.
13. **Analysis Services Processing Task** — обрабатывает объекты SSAS (кубы, измерения).

**Контейнеры и группы:**
- **Sequence Container** — логическая группировка задач.
- **Groups** — визуальное объединение без логической изоляции.

---

### **Глава 6: Расширенные задачи потока управления**

**Задачи для административных операций:**
1. **Analysis Services Execute DDL Task** — выполняет DDL-скрипты для SSAS.
2. **Data Mining Query Task** — выполняет DMX-запросы для прогнозной аналитики.
3. **Message Queue Task** — работает с MSMQ для обмена сообщениями.
4. **Transfer Database Task** — копирует или перемещает базы данных.
5. **Transfer Error Messages Task** — переносит пользовательские сообщения об ошибках.
6. **Transfer Jobs Task** — копирует задания SQL Server Agent.
7. **Transfer Logins Task** — переносит логины между серверами.
8. **Transfer Master Stored Procedures Task** — копирует хранимые процедуры из master.
9. **Transfer SQL Server Objects Task** — переносит объекты БД (таблицы, представления и т.д.).
10. **WMI Data Reader Task** — читает данные через WMI (например, логи Windows).
11. **WMI Event Watcher Task** — отслеживает события WMI.

**Расширенные контейнеры:**
- **For Loop Container** — выполняет цикл заданное число раз.
- **Foreach Loop Container** — перебирает коллекции (файлы, записи БД, XML-узлы).
- **Task Host Container** — невидимый контейнер для каждой задачи, управляющий её свойствами.

---

### **Глава 7: Источники и назначения в потоке данных**

**Основные компоненты потока данных:**
- **Источники** — загружают данные из внешних систем (SQL Server, файлы, Excel).
- **Назначения** — сохраняют данные в целевые хранилища.
- **Преобразования** — обрабатывают данные между источником и назначением.

**Новые возможности в SQL Server 2012:**
- **Source Assistant** — мастер добавления источников.
- **Destination Assistant** — мастер добавления назначений.

**Пример простого потока данных:**
1. Flat File Source → OLE DB Destination.
2. Настройка подключений, сопоставление столбцов, обработка ошибок.

**Обработка ошибок:**
- **Error Output** — перенаправление ошибочных строк в отдельный поток.
- Можно настроить: Fail Component, Ignore Failure, Redirect Row.

**Advanced Editor** — расширенный редактор для тонкой настройки компонентов.

---

### **Глава 8: Преобразования в потоке данных**

**Категории преобразований:**
1. **Row Transformations** — работа со строками:
   - Derived Column — вычисляемые столбцы.
   - Character Map — изменение регистра, кодировок.
   - Copy Column — копирование столбцов.

2. **Rowset Transformations** — работа с наборами строк:
   - Aggregate — агрегация (SUM, AVG, GROUP BY).
   - Sort — сортировка.
   - Percentage Sampling — случайная выборка.

3. **Split and Join Transformations** — разделение и объединение потоков:
   - Conditional Split — условное разделение.
   - Multicast — копирование потока.
   - Merge Join — соединение двух потоков.

4. **Business Intelligence Transformations** — для BI-задач:
   - Fuzzy Lookup — нечёткий поиск.
   - Fuzzy Grouping — группировка с учётом опечаток.
   - Slowly Changing Dimension — управление медленно меняющимися измерениями.

5. **Other Transformations**:
   - Audit — добавление служебной информации (дата, имя пакета).
   - Row Count — подсчёт строк.
   - Script Component — пользовательская логика на C#/VB.NET.

**Советы по производительности:**
- Минимизируйте блокирующие преобразования (Sort, Aggregate).
- Используйте правильные типы данных.
- Оптимизируйте Lookup-преобразования с помощью кэширования.
- Настраивайте размеры буферов (DefaultBufferMaxRows, DefaultBufferSize).

---

## **Итог**

В этих главах подробно разбирается **поток управления** и **поток данных** в SSIS:
- **Поток управления** — это последовательность задач (ETL и административных).
- **Поток данных** — это конвейер для перемещения и трансформации данных.
- **Преобразования** — мощный инструмент для очистки, обогащения и маршрутизации данных.
- **Обработка ошибок** и **отладка** — важные аспекты для создания надёжных пакетов.

