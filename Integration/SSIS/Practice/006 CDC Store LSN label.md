–≠—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ —É –≤—Å–µ—Ö –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –Ω–µ–¥–æ–ø–æ–Ω–∏–º–∞–Ω–∏–µ.** –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º **–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–¥–∞—á–∏ –º–µ—Ç–∫–∏** –º–µ–∂–¥—É –ø–∞–∫–µ—Ç–∞–º–∏.

–í—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤—ã: **–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–∫–µ—Ç–∞ –∂–∏–≤–µ—Ç —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ –ø–∞–∫–µ—Ç–∞.** –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–∞–∫–µ—Ç–∞ –≤—Å–µ –µ–≥–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç—Å—è. –ó–Ω–∞—á–∏—Ç, –Ω—É–∂–µ–Ω **–≤–Ω–µ—à–Ω–∏–π —Ö—Ä–∞–Ω–∏–ª–∏—â—å** –¥–ª—è –º–µ—Ç–∫–∏.

---

## **üéØ –ö–õ–Æ–ß–ï–í–ê–Ø –ö–û–ù–¶–ï–ü–¶–ò–Ø: –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π CDC (CDC State Store)**

CDC –≤ SSIS –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–≤–Ω–µ—à–Ω—é—é —Ç–∞–±–ª–∏—Ü—É** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç–æ–∫ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ –ø–∞–∫–µ—Ç–æ–≤. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `[dbo].[cdc_states]` –≤ —Ü–µ–ª–µ–≤–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–∏–ª–∏ –≤ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π, –∫–æ—Ç–æ—Ä—É—é –≤—ã —É–∫–∞–∂–µ—Ç–µ).

---

## **üîß –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ê–Ø –†–ê–ó–ë–û–†–ö–ê –®–ê–ì –ó–ê –®–ê–ì–û–ú**

### **–®–ê–ì 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–æ–¥–∏–Ω —Ä–∞–∑)**

–í —Ü–µ–ª–µ–≤–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–∫—É–¥–∞ –≤—ã –∑–∞–≥—Ä—É–∂–∞–µ—Ç–µ –¥–∞–Ω–Ω—ã–µ) —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π:

```sql
-- SSIS —Å–æ–∑–¥–∞–µ—Ç –µ–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ CDC Control Task
-- –ù–æ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∏ –≤—Ä—É—á–Ω—É—é
CREATE TABLE [dbo].[cdc_states](
    [state_name] [nvarchar](256) NOT NULL,
    [state] [varbinary](128) NOT NULL,
    [last_update] [datetime] NOT NULL
)
```

---

### **–®–ê–ì 1: Initial Load Package (—Ä–∞–∑–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)**

```
–ü–∞–∫–µ—Ç: InitialLoad.dtsx
‚îú‚îÄ‚îÄ CDC Control Task
‚îÇ   ‚îú‚îÄ‚îÄ Operation: "Mark initial load start"
‚îÇ   ‚îú‚îÄ‚îÄ State Name: "Sales_CDC"  ‚Üê ‚≠ê –ò–ú–Ø –°–û–°–¢–û–Ø–ù–ò–Ø!
‚îÇ   ‚îú‚îÄ‚îÄ State Storage: "Database"
‚îÇ   ‚îú‚îÄ‚îÄ Connection: "TargetDB" (–≥–¥–µ –ª–µ–∂–∏—Ç cdc_states)
‚îÇ   ‚îî‚îÄ‚îÄ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è LSN: "CDC_State" (User::CDC_State)
‚îÇ
‚îú‚îÄ‚îÄ Data Flow Task (–ø–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)
‚îÇ   ‚îî‚îÄ‚îÄ OLE DB Source ‚Üí OLE DB Destination
‚îÇ
‚îî‚îÄ‚îÄ –ù–ï–¢ "Mark processed range"! (–¥–ª—è Initial Load –Ω–µ –Ω—É–∂–Ω–æ)
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏:**

1.  **CDC Control Task** –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–µ `sys.fn_cdc_get_max_lsn()` ‚Üí –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–π LSN (–Ω–∞–ø—Ä–∏–º–µ—Ä, `0x0000001A000001200001`)
2.  **–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —ç—Ç–æ—Ç LSN –í –¢–ê–ë–õ–ò–¶–£ `cdc_states`:**
    ```sql
    INSERT INTO [cdc_states] 
    VALUES ('Sales_CDC', 0x0000001A000001200001, GETDATE())
    ```
3.  **–ò —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–∫–µ—Ç–∞** `User::CDC_State = 0x0000001A000001200001`
4.  **Data Flow Task** –∫–æ–ø–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞–∫–µ—Ç–∞:**
- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `User::CDC_State` —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∞
- **–ù–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `cdc_states` –æ—Å—Ç–∞–ª–∞—Å—å –∑–∞–ø–∏—Å—å:**
  ```
  state_name    | state                           | last_update
  --------------|---------------------------------|-------------------
  Sales_CDC     | 0x0000001A000001200001         | 2024-01-15 10:00:00
  ```

---

### **–®–ê–ì 2: Incremental Load Package (–µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)**

```
–ü–∞–∫–µ—Ç: IncrementalLoad.dtsx
‚îú‚îÄ‚îÄ CDC Control Task #1
‚îÇ   ‚îú‚îÄ‚îÄ Operation: "Get processing range"
‚îÇ   ‚îú‚îÄ‚îÄ State Name: "Sales_CDC"  ‚Üê ‚≠ê –¢–û –ñ–ï –°–ê–ú–û–ï –ò–ú–Ø!
‚îÇ   ‚îú‚îÄ‚îÄ State Storage: "Database"
‚îÇ   ‚îú‚îÄ‚îÄ Connection: "TargetDB" 
‚îÇ   ‚îî‚îÄ‚îÄ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è Start LSN: "CDC_Start"
‚îÇ       –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è End LSN: "CDC_End"
‚îÇ
‚îú‚îÄ‚îÄ Data Flow Task (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
‚îÇ   ‚îú‚îÄ‚îÄ CDC Source
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CDC Processing Mode: "Net"
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Variable with start LSN: "CDC_Start"
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Variable with end LSN: "CDC_End"
‚îÇ   ‚îî‚îÄ‚îÄ CDC Splitter ‚Üí Destinations
‚îÇ
‚îî‚îÄ‚îÄ CDC Control Task #2
    ‚îú‚îÄ‚îÄ Operation: "Mark processed range"
    ‚îú‚îÄ‚îÄ State Name: "Sales_CDC"  ‚Üê ‚≠ê –¢–û –ñ–ï –°–ê–ú–û–ï –ò–ú–Ø!
    ‚îî‚îÄ‚îÄ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é "CDC_End"
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏:**

1.  **CDC Control Task #1 ("Get processing range"):**
    - –ò–¥–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É `cdc_states`, –∏—â–µ—Ç –∑–∞–ø–∏—Å—å —Å `state_name = 'Sales_CDC'`
    - –ù–∞—Ö–æ–¥–∏—Ç `state = 0x0000001A000001200001` (—Ç–æ—Ç —Å–∞–º—ã–π LSN –∏–∑ Initial Load!)
    - **–ó–∞–≥—Ä—É–∂–∞–µ—Ç —ç—Ç–æ—Ç LSN –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `User::CDC_Start`**
    - –¢–∞–∫–∂–µ –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π LSN —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞ ‚Üí `User::CDC_End`

2.  **Data Flow Task:**
    - CDC Source –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `CDC_Start` –∏ `CDC_End` –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å `LSN_A` –¥–æ `LSN_Current`

3.  **CDC Control Task #2 ("Mark processed range"):**
    - –ë–µ—Ä–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `CDC_End`
    - **–û–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ `cdc_states`:**
    ```sql
    UPDATE [cdc_states] 
    SET state = @CDC_End, last_update = GETDATE()
    WHERE state_name = 'Sales_CDC'
    ```
    - –¢–µ–ø–µ—Ä—å –≤ —Ç–∞–±–ª–∏—Ü–µ:
    ```
    state_name    | state                           | last_update
    --------------|---------------------------------|-------------------
    Sales_CDC     | 0x0000001A000001240003         | 2024-01-16 03:00:00
    ```

---

## **üìä –ù–ê–ì–õ–Ø–î–ù–ê–Ø –î–ò–ê–ì–†–ê–ú–ú–ê –ü–ï–†–ï–î–ê–ß–ò –ú–ï–¢–ö–ò**

```
  InitialLoad.dtsx                    –¢–∞–±–ª–∏—Ü–∞ cdc_states                    IncrementalLoad.dtsx
  (–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è 1 —Ä–∞–∑)                (–ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)                (–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     ‚îÇ            ‚îÇ   state_name   | state   ‚îÇ          ‚îÇ                          ‚îÇ
‚îÇ  CDC Control Task   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ          ‚îÇ  CDC Control Task #1     ‚îÇ
‚îÇ "Mark load start"   ‚îÇ    INSERT  ‚îÇ   Sales_CDC    | LSN_A   ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ "Get processing range"   ‚îÇ
‚îÇ                     ‚îÇ            ‚îÇ                          ‚îÇ   SELECT ‚îÇ                          ‚îÇ
‚îÇ  –°–æ—Ö—Ä–∞–Ω—è–µ—Ç: LSN_A   ‚îÇ            ‚îÇ    (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)‚îÇ          ‚îÇ  –ü–æ–ª—É—á–∞–µ—Ç: LSN_A ‚Üí LSN_B ‚îÇ
‚îÇ                     ‚îÇ            ‚îÇ                          ‚îÇ          ‚îÇ                          ‚îÇ
‚îÇ  Data Flow:         ‚îÇ            ‚îÇ                          ‚îÇ          ‚îÇ  Data Flow:              ‚îÇ
‚îÇ  Full copy          ‚îÇ            ‚îÇ                          ‚îÇ          ‚îÇ  Process A‚ÜíB changes     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ                          ‚îÇ          ‚îÇ                          ‚îÇ
                                   ‚îÇ                          ‚îÇ          ‚îÇ  CDC Control Task #2     ‚îÇ
                                   ‚îÇ   Sales_CDC    | LSN_B   ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ "Mark processed range"   ‚îÇ
                                   ‚îÇ                          ‚îÇ   UPDATE ‚îÇ                          ‚îÇ
                                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## **üîç –ö–ê–ö –≠–¢–û –í–´–ì–õ–Ø–î–ò–¢ –í SSIS DESIGNER:**

### **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ CDC Control Task:**

![](https://i.imgur.com/V9kL7tW.png)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –ø–æ–ª—è:**
1.  **State name:** `Sales_CDC` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è —ç—Ç–æ–π –∑–∞–≥—Ä—É–∑–∫–∏)
2.  **Connection:** –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î, –≥–¥–µ –ª–µ–∂–∏—Ç `cdc_states`
3.  **Variable:** –ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –∫—É–¥–∞ –ø–æ–ª–æ–∂–∏—Ç—å LSN

### **CDC Source –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**

![](https://i.imgur.com/7qN4B9Y.png)

- **Processing mode:** Net (—Ç–æ–ª—å–∫–æ –∏—Ç–æ–≥–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
- **Variable containing the CDC start LSN:** `User::CDC_Start`
- **Variable containing the CDC end LSN:** `User::CDC_End`

---

## **üéØ –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ï –í–û–ü–†–û–°–´ –ò –û–¢–í–ï–¢–´:**

### **–í: –ê –µ—Å–ª–∏ —è –¥–µ–ª–∞—é Initial Load –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏?**
**–û:** –¢–æ–≥–¥–∞ –ø—Ä–æ—Ü–µ—Å—Å –º–µ–Ω—è–µ—Ç—Å—è:
1.  –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ –±—ç–∫–∞–ø –≤ —Ü–µ–ª–µ–≤—É—é –ë–î
2.  **–í—Ä—É—á–Ω—É—é –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç–µ LSN**, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞
3.  **–í—Ä—É—á–Ω—É—é –≤—Å—Ç–∞–≤–ª—è–µ—Ç–µ** —ç—Ç–æ—Ç LSN –≤ `cdc_states`
4.  –ó–∞–ø—É—Å–∫–∞–µ—Ç–µ Incremental Load –∫–∞–∫ –æ–±—ã—á–Ω–æ

### **–í: –ê –µ—Å–ª–∏ —É –º–µ–Ω—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü —Å CDC?**
**–û:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ä–∞–∑–Ω—ã–µ `state_name`:
- `Sales_CDC`
- `Customers_CDC` 
- `Products_CDC`

–ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏–º–µ–µ—Ç —Å–≤–æ—é –Ω–µ–∑–∞–≤–∏—Å–∏–º—É—é –º–µ—Ç–∫—É –≤ `cdc_states`.

### **–í: –ú–æ–∂–Ω–æ –ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –≤ –ë–î, –∞ –≤ —Ñ–∞–π–ª–µ?**
**–û:** –î–∞! CDC Control Task –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
- **Database** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)
- **Registry** (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **File** (–¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)

### **–í: –ß—Ç–æ –µ—Å–ª–∏ —è —Å–ª—É—á–∞–π–Ω–æ —É–¥–∞–ª—é –∑–∞–ø–∏—Å—å –∏–∑ cdc_states?**
**–û:** –ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞! Incremental Load –Ω–µ –Ω–∞–π–¥–µ—Ç –º–µ—Ç–∫—É –∏:
1.  –õ–∏–±–æ —É–ø–∞–¥–µ—Ç —Å –æ—à–∏–±–∫–æ–π
2.  –õ–∏–±–æ –Ω–∞—á–Ω–µ—Ç —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ LSN (—Ä–∏—Å–∫—É—è –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ)
3.  **–†–µ—à–µ–Ω–∏–µ:** –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞ –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –ø–æ–ª–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É

---

## **üìù –ü–†–ò–ú–ï–† –†–£–ß–ù–û–ô –†–ê–ë–û–¢–´ –° –¢–ê–ë–õ–ò–¶–ï–ô –°–û–°–¢–û–Ø–ù–ò–ô:**

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
SELECT * FROM [cdc_states]

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫–∞—è –º–µ—Ç–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–∞–∫–æ–π –¥–∞—Ç–µ
SELECT 
    state_name,
    state,
    last_update,
    sys.fn_cdc_map_lsn_to_time(state) AS StateDateTime
FROM [cdc_states]

-- –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∫–∏ (–æ–ø–∞—Å–Ω–æ!)
DECLARE @new_lsn binary(10)
SELECT @new_lsn = sys.fn_cdc_get_max_lsn()

UPDATE [cdc_states] 
SET state = @new_lsn 
WHERE state_name = 'Sales_CDC'

-- –†—É—á–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –º–µ—Ç–∫–∏ (–ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ –±—ç–∫–∞–ø–∞)
INSERT INTO [cdc_states] 
VALUES ('Sales_CDC', 0x0000001A000001200001, GETDATE())
```

---

## **‚ö° –ü–†–û–ë–õ–ï–ú–ê, –ö–û–¢–û–†–£–Æ –í–´ –¢–û–ß–ù–û –í–°–¢–†–ï–¢–ò–¢–ï –ù–ê –ü–†–ê–ö–¢–ò–ö–ï:**

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –í—ã —Å–¥–µ–ª–∞–ª–∏ Initial Load –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫. –í–æ –≤—Ç–æ—Ä–Ω–∏–∫ —Ä–µ—à–∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –µ—â–µ –æ–¥–Ω—É —Ç–∞–±–ª–∏—Ü—É –≤ CDC-–∑–∞–≥—Ä—É–∑–∫—É.

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:** –°–¥–µ–ª–∞—Ç—å Initial Load –¥–ª—è –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã –∏ –∑–∞–±—ã—Ç—å –ø—Ä–æ –º–µ—Ç–∫—É.

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**
1.  –î–ª—è –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—Ç—å **–Ω–æ–≤—ã–π state_name** –≤ CDC Control Task
2.  Initial Load –¥–ª—è –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—Å—Ç —Å–≤–æ—é –∑–∞–ø–∏—Å—å –≤ `cdc_states`
3.  Incremental Load –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–≤—É–º—è –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏ –º–µ—Ç–∫–∞–º–∏

```sql
-- –í cdc_states –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ:
state_name        | state
------------------|-------------------
Sales_CDC         | 0x0000001A000001200001  -- –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã Sales
Customers_CDC     | 0x0000001B000003400002  -- –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã Customers (–¥–æ–±–∞–≤–∏–ª–∏ –ø–æ–∑–∂–µ)
```

---

## **‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ô WORKFLOW –î–õ–Ø –ó–ê–ü–û–ú–ò–ù–ê–ù–ò–Ø:**

1.  **Initial Load Package:**
    - CDC Control Task ‚Üí `Mark initial load start` ‚Üí **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç LSN –≤ `cdc_states`**
    - Data Flow ‚Üí –ö–æ–ø–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

2.  **Incremental Load Package:**
    - CDC Control Task ‚Üí `Get processing range` ‚Üí **–ß–∏—Ç–∞–µ—Ç LSN –∏–∑ `cdc_states`**
    - Data Flow ‚Üí –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç —ç—Ç–æ–≥–æ LSN –¥–æ —Ç–µ–∫—É—â–µ–≥–æ
    - CDC Control Task ‚Üí `Mark processed range` ‚Üí **–û–±–Ω–æ–≤–ª—è–µ—Ç LSN –≤ `cdc_states`**

**–ú–µ—Ç–∫–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –Ω–µ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç–æ–≤, –∞ —á–µ—Ä–µ–∑ –û–ë–©–£–Æ –¢–ê–ë–õ–ò–¶–£ –°–û–°–¢–û–Ø–ù–ò–ô!** –≠—Ç–æ –∫–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ —É–ø—É—Å–∫–∞—é—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏–∑—É—á–µ–Ω–∏–∏ CDC –≤ SSIS.
