# **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (Initial Load) –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∞—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ CDC**.

---

## **–ü—Ä–æ–±–ª–µ–º–∞ –≤ –¥–≤—É—Ö —Å–ª–æ–≤–∞—Ö:**

1.  –£ –≤–∞—Å –µ—Å—Ç—å **–∏—Å—Ç–æ—á–Ω–∏–∫** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `SalesDB`) —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º CDC –Ω–∞ –Ω—É–∂–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö.
2.  –£ –≤–∞—Å –µ—Å—Ç—å **–ø—É—Å—Ç–∞—è —Ü–µ–ª–µ–≤–∞—è –±–∞–∑–∞** (`DWH`).
3.  CDC –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ —Ö—Ä–∞–Ω–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –¥–Ω—è.
4.  –ö–∞–∫ **–≤–ø–µ—Ä–≤—ã–µ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ü–µ–ª–µ–≤—É—é –±–∞–∑—É** (Initial Load) –∏ –ø—Ä–∏ —ç—Ç–æ–º **–Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è**, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ –≤–æ –≤—Ä–µ–º—è —ç—Ç–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è?
5.  –ò –∫–∞–∫ –ø–æ—Ç–æ–º **–ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** (Incremental Load) —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ç–æ—á–∫–∏?

---

## **–ö–ª—é—á–µ–≤–æ–µ –Ω–µ–ø–æ–Ω–∏–º–∞–Ω–∏–µ:** –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –¥–≤–∞ –†–ê–ó–ù–´–• –ø—Ä–æ—Ü–µ—Å—Å–∞

CDC –≤ SSIS ‚Äî —ç—Ç–æ **–¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è**, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è **—Ä–∞–∑–Ω—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏**:

1.  **–ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (Initial Load)** ‚Äî –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã **–ø–æ–ª–Ω—ã–º —Å–Ω–∏–º–∫–æ–º –¥–∞–Ω–Ω—ã—Ö** –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç. –î–ª—è —ç—Ç–æ–≥–æ **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è CDC Source**.
2.  **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (Incremental Load)** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ **—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π**, –ø—Ä–æ–∏–∑–æ—à–µ–¥—à–∏—Ö –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏. –î–ª—è —ç—Ç–æ–≥–æ **–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è CDC Source**.

**–ê —Ç–µ–ø–µ—Ä—å –≥–ª–∞–≤–Ω–æ–µ:** **CDC State (–º–µ—Ç–∫–∞)** ‚Äî —ç—Ç–æ **—Ç–æ—á–∫–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏, –î–û –∫–æ—Ç–æ—Ä–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏—è –º—ã —É–∂–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏.**

---

## **–ü–æ—à–∞–≥–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Å –Ω—É–ª—è:**

### **–®–ê–ì 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**
*   –í –∏—Å—Ç–æ—á–Ω–∏–∫–µ (`SalesDB`) –≤–∫–ª—é—á–µ–Ω CDC –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `Sales`.
*   –í –∏—Å—Ç–æ—á–Ω–∏–∫–µ –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ `cdc.Sales_CT` (—Ç–∞–±–ª–∏—Ü–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π).
*   CDC —Ö—Ä–∞–Ω–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –¥–Ω—è (–Ω–æ —ç—Ç–æ –Ω–µ–≤–∞–∂–Ω–æ –¥–ª—è –ª–æ–≥–∏–∫–∏).
*   –¶–µ–ª–µ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `DWH.dbo.Sales` ‚Äî **–ø—É—Å—Ç–∞—è**.

---

### **–®–ê–ì 1: –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (Initial Load) ‚Äî –ë–ï–ó CDC**

**–¶–µ–ª—å:** –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –í–°–ï —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ —Ü–µ–ª—å.

1.  **–°–æ–∑–¥–∞–µ–º –ø–∞–∫–µ—Ç `Initial_Load.dtsx`.**
2.  **Data Flow Task:**
    *   –ò—Å—Ç–æ—á–Ω–∏–∫: **OLE DB Source** ‚Üí `SELECT * FROM SalesDB.dbo.Sales`
    *   –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: **OLE DB Destination** ‚Üí `DWH.dbo.Sales`
3.  **–ó–∞–ø—É—Å–∫–∞–µ–º —ç—Ç–æ—Ç –ø–∞–∫–µ—Ç.** –¢–µ–ø–µ—Ä—å —Ü–µ–ª–µ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç **–ø–æ–ª–Ω—ã–π —Å–Ω–∏–º–æ–∫** –Ω–∞ –º–æ–º–µ–Ω—Ç `T1`.

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∫–∞ –º—ã –∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏ –¥–∞–Ω–Ω—ã–µ (–¥–æ–ø—É—Å—Ç–∏–º, –æ–ø–µ—Ä–∞—Ü–∏—è –¥–ª–∏–ª–∞—Å—å 2 —á–∞—Å–∞), –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ –º–æ–≥–ª–∏ –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è (INSERT/UPDATE/DELETE). –≠—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
*   –ü–æ–ø–∞–ª–∏ –≤ —Ç–∞–±–ª–∏—Ü—É CDC (`cdc.Sales_CT`)
*   **–ù–ï –ø–æ–ø–∞–ª–∏ –≤ –Ω–∞—à—É –Ω–∞—á–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É** (—Ç.–∫. –º—ã –∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏ —Å—Ç–∞—Ç–∏—á–Ω—ã–π —Å–Ω–∏–º–æ–∫ –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è)

**–í–æ–ø—Ä–æ—Å:** –ö–∞–∫ –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è?

---

### **–®–ê–ì 2: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∏ –Ω–∞—á–∞–ª–∞ CDC (Mark Load Start)**

**–õ–æ–≥–∏–∫–∞:** –ù–∞–º –Ω—É–∂–Ω–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å **–º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –ù–ï–ü–û–°–†–ï–î–°–¢–í–ï–ù–ù–û –ü–ï–†–ï–î –Ω–∞—á–∞–ª–æ–º –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏**. –¢–æ–≥–¥–∞ –ø–æ–∑–∂–µ –º—ã —Å–º–æ–∂–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ **–ü–û–°–õ–ï** —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞.

1.  **–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –ø–∞–∫–µ—Ç `Initial_Load.dtsx`:**
    *   **–î–û** Data Flow Task –¥–æ–±–∞–≤–ª—è–µ–º **CDC Control Task**.
    *   –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –µ–≥–æ: **Operation = "Mark initial load start"**.

2.  **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:**
    *   CDC Control Task **–ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é –æ—Ç–º–µ—Ç–∫—É –≤—Ä–µ–º–µ–Ω–∏** —Å —Å–µ—Ä–≤–µ—Ä–∞-–∏—Å—Ç–æ—á–Ω–∏–∫–∞ (—á–µ–∑–æ–≤ `sys.fn_cdc_get_max_lsn()` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é).
    *   **–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —ç—Ç—É –º–µ—Ç–∫—É (LSN)** –≤ —Ç–∞–±–ª–∏—Ü—É —Å–æ—Å—Ç–æ—è–Ω–∏–π CDC (–Ω–∞–ø—Ä–∏–º–µ—Ä, `cdc_states`).
    *   **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —ç—Ç—É –º–µ—Ç–∫—É –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–∫–µ—Ç–∞** `User::CDC_State`.
    
    **–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ:** –í—ã —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —á–∞—Å—ã –ø—Ä—è–º–æ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç–µ: "–ù–∞—á–∞–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ 10:00:00". –≠—Ç–æ `CDC_State`.

3.  **–ü–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è Data Flow Task** (–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞), –∫–æ—Ç–æ—Ä–∞—è –∫–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ.

---

### **–®–ê–ì 3: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –ø—Ä–æ–∏–∑–æ—à–µ–¥—à–∏—Ö –í–û –í–†–ï–ú–Ø –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏**

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, —É –Ω–∞—Å –µ—Å—Ç—å:
*   –¶–µ–ª–µ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –Ω–∞ –ø—Ä–∏–º–µ—Ä–Ω—ã–π –º–æ–º–µ–Ω—Ç `T1` (–Ω–∞—á–∞–ª–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è)
*   –ú–µ—Ç–∫–∞ `CDC_State = LSN_T1` (—Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞)

–¢–µ–ø–µ—Ä—å –Ω–∞–º –Ω—É–∂–Ω–æ "–¥–æ–≥–Ω–∞—Ç—å" –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ **–ú–ï–ñ–î–£ `T1` –∏ `T2`** (–≥–¥–µ `T2` ‚Äî –º–æ–º–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏).

1.  **–°–æ–∑–¥–∞–µ–º –ø–∞–∫–µ—Ç `Incremental_Load.dtsx`** (–∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ–≥–¥–∞).
2.  **Control Flow:**
    *   **CDC Control Task** (Operation = "Get processing range") ‚Äî –±–µ—Ä–µ—Ç –∏–∑ —Ç–∞–±–ª–∏—Ü—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –º–µ—Ç–∫—É (`LSN_T1`) –∏ **–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å**.
    *   **Data Flow Task:**
        *   –ò—Å—Ç–æ—á–Ω–∏–∫: **CDC Source** ‚Üí –£–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –∏ –¥–∏–∞–ø–∞–∑–æ–Ω LSN
        *   –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å—Ç–∞–≤–æ–∫/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π/—É–¥–∞–ª–µ–Ω–∏–π
        *   –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: **CDC Splitter** + —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ Destination
    *   **CDC Control Task** (Operation = "Mark processed range") ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç –º–µ—Ç–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –Ω–∞ **–∫–æ–Ω–µ—Ü –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞**.

3.  **–ó–∞–ø—É—Å–∫–∞–µ–º `Incremental_Load.dtsx` —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ `Initial_Load.dtsx`**:
    *   –û–Ω –≤–æ–∑—å–º–µ—Ç –º–µ—Ç–∫—É `LSN_T1` (–Ω–∞—á–∞–ª–æ –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏)
    *   –ó–∞–≥—Ä—É–∑–∏—Ç –í–°–ï –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ —Å –º–æ–º–µ–Ω—Ç–∞ `LSN_T1` –¥–æ **—Ç–µ–∫—É—â–µ–≥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ LSN** –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ
    *   –û–±–Ω–æ–≤–∏—Ç –º–µ—Ç–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä—å —Ü–µ–ª–µ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ **—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞** —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç!

---

## **–ê —á—Ç–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º "3 –¥–Ω—è —Ö—Ä–∞–Ω–µ–Ω–∏—è CDC"?**

–≠—Ç–æ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ** –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏!

**–°—Ü–µ–Ω–∞—Ä–∏–π –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã:**
1.  –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ–≥—Ä–æ–º–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –∑–∞–Ω—è–ª–∞ **4 –¥–Ω—è**.
2.  CDC –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ —Ö—Ä–∞–Ω–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ **3 –¥–Ω—è**.
3.  –ö –º–æ–º–µ–Ω—Ç—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏, **—Å–∞–º—ã–µ —Ä–∞–Ω–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–ø–µ—Ä–≤—ã–µ –¥–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏) —É–∂–µ —É–¥–∞–ª–µ–Ω—ã –∏–∑ CDC**.
4.  –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ **–Ω–µ —Å–º–æ–∂–µ—Ç "–¥–æ–≥–Ω–∞—Ç—å" —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è** ‚Üí **–ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö!**

**–†–µ—à–µ–Ω–∏–µ:**
1.  **–†–∞–∑–±–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –Ω–∞ —á–∞—Å—Ç–∏** (–ø–æ –¥–∞—Ç–∞–º, –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º –∫–ª—é—á–µ–π).
2.  **–î–ª—è –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏:**
    *   –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç–∫—É CDC (Mark load start)
    *   –ó–∞–≥—Ä—É–∑–∏—Ç—å —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
    *   –°—Ä–∞–∑—É –∂–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ —ç—Ç–æ–π —á–∞—Å—Ç–∏ (–ø–æ–∫–∞ –æ–Ω–∏ –µ—â–µ –≤ CDC)
    *   –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∫—É
3.  **–ò–ª–∏:** –£–≤–µ–ª–∏—á–∏—Ç—å —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è CDC –Ω–∞ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.

---

## **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π —à–∫–∞–ª–æ–π:**

```
–í—Ä–µ–º—è   | –î–µ–π—Å—Ç–≤–∏–µ
--------|---------------------------------------------------
10:00   | –ó–∞–ø—É—Å–∫ Initial_Load.dtsx
10:00:01| CDC Control Task: Mark load start ‚Üí CDC_State = LSN_A
10:00:02| –ù–∞—á–∞–ª–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (2 –º–ª–Ω —Å—Ç—Ä–æ–∫)
12:00   | –í –∏—Å—Ç–æ—á–Ω–∏–∫–µ: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω—è–µ—Ç —Å—Ç—Ä–æ–∫—É ID=100 (—ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ cdc.Sales_CT —Å LSN_B, –≥–¥–µ B > A)
13:00   | –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        | –¢–µ–ø–µ—Ä—å –≤ —Ü–µ–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ ~10:00, –Ω–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ ID=100
13:01   | –ó–∞–ø—É—Å–∫ Incremental_Load.dtsx
13:01   | CDC Control Task: Get processing range ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç CDC_State = LSN_A
13:01   | CDC Source: –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å LSN > A –¥–æ —Ç–µ–∫—É—â–µ–≥–æ –º–∞–∫—Å–∏–º—É–º–∞
        | –ù–∞—Ö–æ–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ ID=100 (LSN_B) –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –µ–≥–æ –∫ —Ü–µ–ª–∏
13:02   | CDC Control Task: Mark processed range ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç CDC_State –Ω–∞ LSN_C (—Ç–µ–∫—É—â–∏–π –º–∞–∫—Å–∏–º—É–º)
```

–¢–µ–ø–µ—Ä—å —Ü–µ–ª–µ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–∫—Ç—É–∞–ª—å–Ω–∞**.

---

## **–ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è CDC_State –∏ –∫–∞–∫ –æ–Ω–∞ –≤—ã–≥–ª—è–¥–∏—Ç?**

–ú–µ—Ç–∫–∞ CDC ‚Äî —ç—Ç–æ **–Ω–µ –¥–∞—Ç–∞/–≤—Ä–µ–º—è**, –∞ **LSN (Log Sequence Number)** ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –∂—É—Ä–Ω–∞–ª–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π SQL Server.

*   **–¢–∞–±–ª–∏—Ü–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π:** –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `[dbo].[cdc_states]` –≤ —Ü–µ–ª–µ–≤–æ–π –ë–î (–∏–ª–∏ –≤ –ë–î, —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤ CDC Control Task).
*   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** `state_name`, `state` (–±–∏–Ω–∞—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ LSN), `last_update`.
*   **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–∫–µ—Ç–∞:** `User::CDC_State` —Å–æ–¥–µ—Ä–∂–∏—Ç **—ç—Ç–æ –±–∏–Ω–∞—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**.

---

## **–û—Ç–≤–µ—Ç –Ω–∞ –≤–∞—à –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å:**

> "–∫–∞–∫ –º—ã –≤—ã—á–∏—Å–ª–∏–º –º–µ—Ç–∫—É, —Å –∫–æ—Ç–æ—Ä–æ–π –Ω–∞–¥–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –¥–∞–ª—å—à–µ?"

**–í—ã –µ–µ –Ω–µ –≤—ã—á–∏—Å–ª—è–µ—Ç–µ ‚Äî –≤—ã –µ–µ –ó–ê–ü–û–ú–ù–ò–¢–ï (–∑–∞–ø–∏—à–µ—Ç–µ) –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π.**

1.  **–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π:** –í—ã–ø–æ–ª–Ω—è–µ—Ç–µ `Mark initial load start` ‚Üí –ø–æ–ª—É—á–∞–µ—Ç–µ `CDC_State = LSN_X`.
2.  **–í—ã–ø–æ–ª–Ω—è–µ—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É.**
3.  **–ü–æ—Å–ª–µ –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏:** –ó–∞–ø—É—Å–∫–∞–µ—Ç–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É, –∫–æ—Ç–æ—Ä–∞—è:
    *   –ë–µ—Ä–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é `LSN_X`
    *   –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å `LSN > X`
    *   –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

**–ï—Å–ª–∏ CDC –ø—É—Å—Ç–æ–π –∏–ª–∏ —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–µ–∫:**
*   **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `sys.fn_cdc_get_min_lsn('Sales')` –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å —Å –≤–∞—à–µ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π.
*   **–ï—Å–ª–∏ –≤–∞—à–∞ –º–µ—Ç–∫–∞ —Å—Ç–∞—Ä—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ LSN** ‚Üí **–¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã**, –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å **–ø–æ–ª–Ω—É—é –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É**.

---

# –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç, –µ—Å–ª–∏ –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã –∑–∞–±—É–¥–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É, –∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –µ–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é, –ø—Ä–∏ —ç—Ç–æ–º CDC —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ 3 –¥–Ω—è?

---

## **–°—Ü–µ–Ω–∞—Ä–∏–π: "–ó–∞–±—ã–ª–∏ –ø—Ä–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É"**

**–ò—Å—Ö–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è:**
- –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –≤ `–ü–Ω, 10:00` (CDC State = `LSN_–ü–Ω_10:00`)
- CDC —Ö—Ä–∞–Ω–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è **3 –¥–Ω—è**
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –∑–∞–±—ã–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
- –í—Å–ø–æ–º–Ω–∏–ª–∏ –∏ –∑–∞–ø—É—Å—Ç–∏–ª–∏ —Ç–æ–ª—å–∫–æ **–≤ –ß—Ç, 10:00** (—á–µ—Ä–µ–∑ 3 –¥–Ω—è)

---

### **–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –≤ –º–æ–º–µ–Ω—Ç –∑–∞–ø—É—Å–∫–∞ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ß—Ç, 10:00:**

1.  **CDC Control Task (Get processing range):**
    - –î–æ—Å—Ç–∞–µ—Ç –∏–∑ —Ç–∞–±–ª–∏—Ü—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –º–µ—Ç–∫—É: `LSN_–ü–Ω_10:00`
    - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É SQL Server —Ç–µ–∫—É—â–∏–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π LSN —á–µ—Ä–µ–∑ `sys.fn_cdc_get_max_lsn()`

2.  **SQL Server –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∫–∞–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω—ã:**
    - –í—ã–ø–æ–ª–Ω—è–µ—Ç `sys.fn_cdc_get_min_lsn('schema_table')` ‚Üí –ø–æ–ª—É—á–∞–µ—Ç **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π LSN**
    - **–ü–æ—Å–∫–æ–ª—å–∫—É CDC —Ö—Ä–∞–Ω–∏—Ç 3 –¥–Ω—è, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π LSN –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ = `LSN_–ü–Ω_10:00` (–∏–ª–∏ –Ω–µ–º–Ω–æ–≥–æ –ø–æ–∑–∂–µ)**
    - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π LSN = `LSN_–ß—Ç_10:00`

3.  **–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:**
    - –ï—Å–ª–∏ –≤–∞—à —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π `LSN_–ü–Ω_10:00` **–°–¢–ê–†–®–ï** –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ LSN ‚Üí **–æ—à–∏–±–∫–∞!**
    - SQL Server –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å `LSN_–ü–Ω_10:00`, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∏ —É–∂–µ —É–¥–∞–ª–µ–Ω—ã
    - **–ù–æ:** –¢–∞–∫ –∫–∞–∫ –ø—Ä–æ—à–ª–æ —Ä–æ–≤–Ω–æ 3 –¥–Ω—è, –µ—Å—Ç—å —à–∞–Ω—Å, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å `LSN_–ü–Ω_10:00` –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω—ã (–≥—Ä–∞–Ω–∏—á–Ω—ã–π —Å–ª—É—á–∞–π)

4.  **–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –ü–Ω –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω—ã:**
    - CDC Source –∑–∞–ø—Ä–æ—Å–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å `LSN_–ü–Ω_10:00` –¥–æ `LSN_–ß—Ç_10:00`
    - **–ù–û!** –ò–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ –≤ **–ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏** (—Å –ü–Ω 10:00 –¥–æ –í—Ç 10:00) —É–∂–µ —É–¥–∞–ª–µ–Ω—ã –∏–∑ CDC!
    - CDC Source –ø–æ–ª—É—á–∏—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è **–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –¥–Ω—è** (—Å–æ –í—Ç 10:00 –¥–æ –ß—Ç 10:00)

---

## **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö:**

```
–í—Ä–µ–º—è     | CDC –¥–∞–Ω–Ω—ã–µ –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ          | –ß—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
----------|--------------------------------|-------------------
–ü–Ω 09:59 | –£–∂–µ —É–¥–∞–ª–µ–Ω–æ (4 –¥–Ω—è –Ω–∞–∑–∞–¥)       | 
–ü–Ω 10:00 | [–ù–ê–ß–ê–õ–¨–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê] CDC State = LSN_A |
–ü–Ω 10:01 | –ò–∑–º–µ–Ω–µ–Ω–∏–µ 1 (LSN_B)             | ‚ùå –£–î–ê–õ–ï–ù–û –∏–∑ CDC
–ü–Ω 12:00 | –ò–∑–º–µ–Ω–µ–Ω–∏–µ 2 (LSN_C)             | ‚ùå –£–î–ê–õ–ï–ù–û –∏–∑ CDC
–í—Ç 08:00 | –ò–∑–º–µ–Ω–µ–Ω–∏–µ 3 (LSN_D)             | ‚ùå –£–î–ê–õ–ï–ù–û –∏–∑ CDC
–í—Ç 10:01 | –ò–∑–º–µ–Ω–µ–Ω–∏–µ 4 (LSN_E)             | ‚úì –î–û–°–¢–£–ü–ù–û (3 –¥–Ω—è)
–°—Ä 14:00 | –ò–∑–º–µ–Ω–µ–Ω–∏–µ 5 (LSN_F)             | ‚úì –î–û–°–¢–£–ü–ù–û (2 –¥–Ω—è)
–ß—Ç 09:59 | –ò–∑–º–µ–Ω–µ–Ω–∏–µ 6 (LSN_G)             | ‚úì –î–û–°–¢–£–ü–ù–û (1 –¥–µ–Ω—å)
–ß—Ç 10:00 | [–ó–ê–ü–£–°–ö –ò–ù–ö–†–ï–ú–ï–ù–¢–ê–õ–¨–ù–û–ô –ó–ê–ì–†–£–ó–ö–ò] |
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò–∑ 6 –∏–∑–º–µ–Ω–µ–Ω–∏–π, –ø—Ä–æ–∏–∑–æ—à–µ–¥—à–∏—Ö –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏, –∑–∞–≥—Ä—É–∑—è—Ç—Å—è —Ç–æ–ª—å–∫–æ **3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö** (E, F, G). –ò–∑–º–µ–Ω–µ–Ω–∏—è B, C, D –±—É–¥—É—Ç **–±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ –ø–æ—Ç–µ—Ä—è–Ω—ã**.

---

## **–ö–∞–∫ SSIS –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç—É —Å–∏—Ç—É–∞—Ü–∏—é?**

### **–í–∞—Ä–∏–∞–Ω—Ç 1: –û—à–∏–±–∫–∞ "The requested LSN is less than the minimum available LSN"**
CDC Source —É–ø–∞–¥–µ—Ç —Å –æ—à–∏–±–∫–æ–π, –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π –Ω–∞—á–∞–ª—å–Ω—ã–π LSN —É–∂–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

### **–í–∞—Ä–∏–∞–Ω—Ç 2: –ß–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞**
–ï—Å–ª–∏ –Ω–∞—á–∞–ª—å–Ω—ã–π LSN –µ—â–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ —á–∞—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω–∞ —É–∂–µ —É–¥–∞–ª–µ–Ω–∞ ‚Äî –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å. **–ë–µ–∑ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π!**

**–≠—Ç–æ —Å—Ç—Ä–∞—à–Ω–æ –∏–º–µ–Ω–Ω–æ –ø–æ—Ç–æ–º—É, —á—Ç–æ:**
- –ü–∞–∫–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è **—É—Å–ø–µ—à–Ω–æ** (–∑–µ–ª–µ–Ω–∞—è –≥–∞–ª–æ—á–∫–∞)
- –í –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç —É–∫–∞–∑–∞–Ω–æ, —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
- **–ù–∏–∫–∞–∫–∏—Ö –æ—à–∏–±–æ–∫ –æ –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ –±—É–¥–µ—Ç!**
- –í—ã —É–∑–Ω–∞–µ—Ç–µ –æ –ø—Ä–æ–±–ª–µ–º–µ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –±–∏–∑–Ω–µ—Å —Å–ø—Ä–æ—Å–∏—Ç: "–ê –≥–¥–µ –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫?"

---

## **–ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç —ç—Ç–æ–≥–æ?**

### **1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ä–æ–∫–æ–≤ —Ö—Ä–∞–Ω–µ–Ω–∏—è CDC:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ —É—Å—Ç–∞—Ä–µ–ª–∞ –ª–∏ –Ω–∞—à–∞ –º–µ—Ç–∫–∞
DECLARE @min_lsn binary(10), @stored_lsn binary(10)

-- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π LSN
SELECT @min_lsn = sys.fn_cdc_get_min_lsn('Sales')

-- –ù–∞—à —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π LSN
SELECT @stored_lsn = state FROM cdc_states WHERE state_name = 'Sales_CDC'

-- –ï—Å–ª–∏ –Ω–∞—à LSN —Å—Ç–∞—Ä—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ -> –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã
IF @stored_lsn < @min_lsn
    RAISERROR('CDC data loss detected! Stored LSN is older than available min LSN.', 16, 1)
```

### **2. –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –ø–∞–∫–µ—Ç–µ:**
–î–æ–±–∞–≤–∏—Ç—å **Script Task** –ø–µ—Ä–µ–¥ CDC Source, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º LSN –∏ —Ç–µ–∫—É—â–∏–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º LSN.

### **3. –£–≤–µ–ª–∏—á–∏—Ç—å —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è CDC:**
–î–ª—è production-—Å–∏—Å—Ç–µ–º, –≥–¥–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è CDC **–Ω–µ –º–µ–Ω–µ–µ 7-14 –¥–Ω–µ–π**, –¥–∞–∂–µ –µ—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è.

### **4. –ê–≤–∞—Ä–∏–π–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:**
```sql
-- –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ –ø–æ—Ç–µ—Ä—é –¥–∞–Ω–Ω—ã—Ö
-- 1. –£–≤–µ–ª–∏—á–∏—Ç—å —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è CDC –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
EXEC sp_cdc_change_job @job_type = 'cleanup', @retention = 10080 -- –º–∏–Ω—É—Ç (7 –¥–Ω–µ–π)

-- 2. –°–¥–µ–ª–∞—Ç—å –ø–æ–ª–Ω—É—é –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É:
--    –∞) –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∏–∑ cdc_states
--    –±) –í—ã–ø–æ–ª–Ω–∏—Ç—å Initial Load –∑–∞–Ω–æ–≤–æ
--    –≤) –ù–∞—á–∞—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É —Å –Ω–æ–≤–æ–π –º–µ—Ç–∫–∏
```

---

## **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤:**

**–í—Å–µ–≥–¥–∞ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ CDC —Å –∑–∞–ø–∞—Å–æ–º:**
- –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ ‚Üí —Ö—Ä–∞–Ω–∏—Ç—å 7 –¥–Ω–µ–π
- –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ ‚Üí —Ö—Ä–∞–Ω–∏—Ç—å 14 –¥–Ω–µ–π
- –ü–ª—é—Å —É—á–∏—Ç—ã–≤–∞–π—Ç–µ –≤—Ä–µ–º—è –Ω–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Å–±–æ–µ–≤

**–ò —Å–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ ‚Äî –º–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —ç—Ç–æ—Ç –∑–∞–ø–∞—Å:**
```sql
-- –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
SELECT 
    DATEDIFF(HOUR, 
        sys.fn_cdc_map_lsn_to_time(@stored_lsn), -- –≤—Ä–µ–º—è –≤–∞—à–µ–≥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ LSN
        sys.fn_cdc_map_lsn_to_time(@min_lsn)     -- –≤—Ä–µ–º—è —Å–∞–º–æ–≥–æ —Å—Ç–∞—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ LSN
    ) AS HoursOfDataLossRisk
-- –ï—Å–ª–∏ –º–µ–Ω—å—à–µ 24 —á–∞—Å–æ–≤ –¥–æ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö -> –∞–ª–µ—Ä—Ç!
```

---

# –ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ, –Ω–æ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞–≤–∏—Å–ª–∞ –Ω–∞ 12 —á–∞—Å–æ–≤, –∞ –ø–æ—Ç–æ–º –±—ã–ª–∞ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∞? –ü–æ—Ç–µ—Ä—è—é—Ç—Å—è –ª–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å—Ä–æ–∫–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è CDC = 3 –¥–Ω—è?

---

## **–°—Ü–µ–Ω–∞—Ä–∏–π: –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–∏—Å–ª–∞ –∏ –±—ã–ª–∞ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∞**

**–î–µ—Ç–∞–ª–∏:**
- –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ 03:00
- CDC —Ö—Ä–∞–Ω–∏—Ç 3 –¥–Ω—è (72 —á–∞—Å–∞)
- **–ü–Ω 03:00** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —É—Å–ø–µ—à–Ω–∞, –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –í—Å 03:00 –¥–æ –ü–Ω 03:00
- **–í—Ç 03:00** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ **–∑–∞–≤–∏—Å–ª–∞**, —Ä–∞–±–æ—Ç–∞–µ—Ç 12 —á–∞—Å–æ–≤
- **–í—Ç 15:00** ‚Äî –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É–±–∏–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å, –≤–∏–¥–∏—Ç, —á—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å
- **–í—Ç 15:01** ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Ä—É—á–Ω—É—é

---

## **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å CDC State (–º–µ—Ç–∫–æ–π)?**

### **–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:** 
**CDC State –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ CDC Control Task "Mark processed range"!**

–ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–∏—Å–ª–∞ –∏ –±—ã–ª–∞ —É–±–∏—Ç–∞:
1. **CDC State –ù–ï –æ–±–Ω–æ–≤–∏–ª–∞—Å—å** ‚Äî –æ—Å—Ç–∞–ª–∞—Å—å —Ä–∞–≤–Ω–æ–π `LSN_–ü–Ω_03:00`
2. **–ß–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –º–æ–≥–ª–∞ —É–∂–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è** (–µ—Å–ª–∏ –∑–∞–≤–∏—Å–ª–∞ –Ω–∞ –ø–æ–∑–¥–Ω–µ–º —ç—Ç–∞–ø–µ)
3. **–ù–æ –º–µ—Ç–∫–∞ –Ω–µ —Å–¥–≤–∏–Ω—É–ª–∞—Å—å**

---

## **–ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –≤ 15:00:**

### **1. CDC Control Task "Get processing range":**
- –î–æ—Å—Ç–∞–µ—Ç –∏–∑ —Ç–∞–±–ª–∏—Ü—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –º–µ—Ç–∫—É: `LSN_–ü–Ω_03:00`
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: `LSN_–ü–Ω_03:00` ‚Üí `—Ç–µ–∫—É—â–∏–π_–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π_LSN`

### **2. –ü—Ä–æ–±–ª–µ–º–∞:** 
**–î–∏–∞–ø–∞–∑–æ–Ω –æ–≥—Ä–æ–º–Ω—ã–π!** –ù—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- **–ü–Ω 03:00 - –í—Ç 03:00** (—É–∂–µ –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –≤—á–µ—Ä–∞)
- **–í—Ç 03:00 - –í—Ç 15:00** (–Ω–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è + –≤—Ä–µ–º—è –∑–∞–≤–∏—Å–∞–Ω–∏—è)

### **3. –†–∏—Å–∫:**
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:** –ß–∞—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ `–ü–Ω 03:00 - –í—Ç 03:00` —É–∂–µ –º–æ–≥–ª–∞ –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–æ –∑–∞–≤–∏—Å–∞–Ω–∏—è
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –û–±—Ä–∞–±–æ—Ç–∫–∞ 36-—á–∞—Å–æ–≤–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –≤–º–µ—Å—Ç–æ 24-—á–∞—Å–æ–≤–æ–≥–æ
- **–ù–æ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –ù–ï –±—É–¥–µ—Ç** (–µ—Å–ª–∏ CDC —Ö—Ä–∞–Ω–∏—Ç 3 –¥–Ω—è)

---

## **–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–∞–∫–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π?**

### **–ü–∞—Ç—Ç–µ—Ä–Ω 1: "–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è" –∑–∞–≥—Ä—É–∑–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
–ï—Å–ª–∏ –≤–∞—à–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞ (–ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ—Ö –∂–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –¥—É–±–ª–∏), —Ç–æ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç–µ. CDC Source –≤—ã–¥–∞—Å—Ç —Ç–µ –∂–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–æ –≤–∞—à–∞ –ª–æ–≥–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –∏—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å.

**–ü—Ä–∏–º–µ—Ä –¥–ª—è UPSERT (–≤—Å—Ç–∞–≤–∫–∞ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ):**
```sql
-- –í–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ–≥–æ INSERT –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ MERGE
MERGE TargetTable AS t
USING (SELECT * FROM #CDC_Changes) AS s
ON t.ID = s.ID
WHEN MATCHED THEN UPDATE SET ...
WHEN NOT MATCHED THEN INSERT ...
-- –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```

### **–ü–∞—Ç—Ç–µ—Ä–Ω 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ "—á—Ç–æ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ"**
–ü–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç–µ, –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ª–∏ —É–∂–µ –¥–∞–Ω–Ω—ã–µ –∑–∞ —ç—Ç–æ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω:

```sql
-- –í Script Task –ø–µ—Ä–µ–¥ CDC Source
DECLARE @LastLoadedDate DATETIME
SELECT @LastLoadedDate = MAX(LoadDate) FROM TargetTable

-- –ï—Å–ª–∏ —É –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞ —Å–µ–≥–æ–¥–Ω—è, –≤–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω
```

### **–ü–∞—Ç—Ç–µ—Ä–Ω 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Checkpoints –≤ SSIS**
–ù–∞—Å—Ç—Ä–æ–∏–≤ Control Points, –º–æ–∂–Ω–æ –∑–∞—Å—Ç–∞–≤–∏—Ç—å –ø–∞–∫–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è **—Å –º–µ—Å—Ç–∞ —Å–±–æ—è**, –∞ –Ω–µ —Å –Ω–∞—á–∞–ª–∞.

---

## **–ê —á—Ç–æ –µ—Å–ª–∏ –∑–∞–≤–∏—Å–∞–Ω–∏–µ –±—ã–ª–æ –¥–æ–ª—å—à–µ, —á–µ–º —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è CDC?**

**–í–æ—Ç —Ç—É—Ç —Ä–µ–∞–ª—å–Ω–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å!**

–°—Ü–µ–Ω–∞—Ä–∏–π:
- –ó–∞–≤–∏—Å–ª–∞ –∑–∞–≥—Ä—É–∑–∫–∞ **–ü–Ω 03:00**
- –û–±–Ω–∞—Ä—É–∂–∏–ª–∏ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª–∏ —Ç–æ–ª—å–∫–æ **–ß—Ç 18:00** (—á–µ—Ä–µ–∑ 87 —á–∞—Å–æ–≤)
- CDC —Ö—Ä–∞–Ω–∏—Ç **72 —á–∞—Å–∞** (3 –¥–Ω—è)

**–†–∞—Å—á–µ—Ç:**
- –ü–æ—Å–ª–µ–¥–Ω–∏–π —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫: `LSN_–í—Å_03:00`
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π LSN –≤ –ß—Ç 18:00: `LSN_–ü–Ω_18:00` (72 —á–∞—Å–∞ –Ω–∞–∑–∞–¥)
- –ù–∞—à–∞ –º–µ—Ç–∫–∞ `LSN_–í—Å_03:00` **—É–∂–µ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ CDC**!

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
1. CDC Source —É–ø–∞–¥–µ—Ç —Å –æ—à–∏–±–∫–æ–π "requested LSN is less than min LSN"
2. **–ò–ª–∏** (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫) –ø–æ–ø—Ä–æ–±—É–µ—Ç –Ω–∞—á–∞—Ç—å —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ LSN
3. **–ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –∑–∞ 39 —á–∞—Å–æ–≤!** (–í—Å 03:00 - –ü–Ω 18:00)

---

## **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:**

### **1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
```sql
-- –ê–ª–µ—Ä—Ç, –µ—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∏–¥–µ—Ç –¥–æ–ª—å—à–µ N —á–∞—Å–æ–≤
IF (SELECT DATEDIFF(HOUR, start_time, GETDATE()) 
    FROM [SSISDB].[catalog].[executions] 
    WHERE status = 2 AND package_name = 'YourPackage') > 6
BEGIN
    -- –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–∞, –ø–æ–ø—ã—Ç–∫–∞ graceful stop
    EXEC [catalog].[stop_operation] @operation_id
END
```

### **2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ timeout –≤ SQL Agent Job:**
```
–í —à–∞–≥–µ Job: 
- Advanced ‚Üí "Quit the job reporting failure" ‚Üí 4 hours
```

### **3. –†–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ "–æ—Ç—Å—Ç–∞–≤–∞–Ω–∏—è":**
```sql
-- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç: –Ω–∞ —Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –æ—Ç—Å—Ç–∞–µ—Ç –Ω–∞—à CDC State
SELECT 
    state_name,
    DATEDIFF(HOUR, 
        sys.fn_cdc_map_lsn_to_time(state),  -- –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–µ—Ç–∫–∏
        GETDATE()                           -- —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
    ) AS HoursBehind,
    CASE 
        WHEN DATEDIFF(HOUR, sys.fn_cdc_map_lsn_to_time(state), GETDATE()) > 48 
        THEN 'WARNING: More than 2 days behind!'
        WHEN DATEDIFF(HOUR, sys.fn_cdc_map_lsn_to_time(state), GETDATE()) > 24 
        THEN 'CAUTION: More than 1 day behind'
        ELSE 'OK'
    END AS Status
FROM cdc_states
```

### **4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π:**
```powershell
# –ü—Å–µ–≤–¥–æ–∫–æ–¥ –¥–ª—è —Å–∫—Ä–∏–ø—Ç–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
$lastSuccessTime = Get-LastSuccessfulRunTime
$cdcRetentionHours = 72
$hoursSinceSuccess = (Get-Date) - $lastSuccessTime

if ($hoursSinceSuccess.TotalHours -gt $cdcRetentionHours - 12) {
    # –û–ø–∞—Å–Ω–æ! –ú–∞–ª–æ –∑–∞–ø–∞—Å–∞. –ù—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
    Write-Output "CDC data loss risk! Need FULL reload."
    Start-FullReloadProcess
} else {
    # –ï—â–µ –µ—Å—Ç—å –∑–∞–ø–∞—Å, –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
    Write-Output "Safe to restart incremental load"
    Restart-SSISPackage
}
```

---

## **–û—Ç–≤–µ—Ç –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å:**

**–î–∞, –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ—á–∏—Ç–∞–Ω –¥–∏–∞–ø–∞–∑–æ–Ω —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏, –∏ –µ—Å–ª–∏:**
1. **CDC –µ—â–µ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ —Å —Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞** (—Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ –∏—Å—Ç–µ–∫)
2. **–í–∞—à–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞** (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥—É–±–ª–∏)
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∑–≤–æ–ª—è–µ—Ç** –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω

**–¢–æ –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–∞–ª–∞–¥–∏—Ç—Å—è.**

**–ù–æ –µ—Å–ª–∏ –ª—é–±–æ–µ –∏–∑ —ç—Ç–∏—Ö —É—Å–ª–æ–≤–∏–π –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è ‚Äî –±—É–¥—É—Ç –ø—Ä–æ–±–ª–µ–º—ã.**

---

**–ò—Ç–æ–≥–æ–≤–∞—è –º—ã—Å–ª—å:** CDC-–∑–∞–≥—Ä—É–∑–∫–∞ –≤ SSIS ‚Äî —ç—Ç–æ **–æ—á–µ–Ω—å –Ω–∞–¥–µ–∂–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º, –Ω–æ —Å —á–µ—Ç–∫–∏–º–∏ –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏**. –≠—Ç–∏ –≥—Ä–∞–Ω–∏—Ü—ã –∑–∞–¥–∞—é—Ç—Å—è **—Å—Ä–æ–∫–æ–º —Ö—Ä–∞–Ω–µ–Ω–∏—è CDC** –∏ **—Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**. –í—ã—Ö–æ–¥ –∑–∞ —ç—Ç–∏ –≥—Ä–∞–Ω–∏—Ü—ã —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (—á–∞—Å—Ç–æ ‚Äî –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö).

# Checkpoints
**Checkpoints (–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏) –≤ SSIS ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –ø–∞–∫–µ—Ç—É, –∫–æ—Ç–æ—Ä—ã–π —É–ø–∞–ª, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –° –ú–ï–°–¢–ê –°–ë–û–Ø, –∞ –Ω–µ —Å –Ω–∞—á–∞–ª–∞.** –≠—Ç–æ –∫–∞–∫ "—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏–≥—Ä–µ" –¥–ª—è ETL-–ø—Ä–æ—Ü–µ—Å—Å–∞.

---

## **–ü—Ä–æ—Å—Ç–∞—è –∞–Ω–∞–ª–æ–≥–∏—è:**

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã –ø–∏—à–µ—Ç–µ –¥–ª–∏–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –∏–∑ 10 –≥–ª–∞–≤:
- **–ë–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Ç–æ—á–µ–∫:** –ï—Å–ª–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä –≤—ã–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ 9-–π –≥–ª–∞–≤–µ, –≤—ã –Ω–∞—á–∏–Ω–∞–µ—Ç–µ **—Å –Ω—É–ª—è**.
- **–° –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏:** –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –≥–ª–∞–≤—ã –≤—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ—Å—å. –ï—Å–ª–∏ —Å–±–æ–π –Ω–∞ 9-–π –≥–ª–∞–≤–µ, –≤—ã –∑–∞–≥—Ä—É–∂–∞–µ—Ç–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ **–ø–æ—Å–ª–µ 8-–π –≥–ª–∞–≤—ã** –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç–µ.

---

## **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏?**

### **1. –í–∫–ª—é—á–µ–Ω–∏–µ Checkpoints:**
–í —Å–≤–æ–π—Å—Ç–≤–∞—Ö –ø–∞–∫–µ—Ç–∞ (`Package.dtsx`):
- **CheckpointFileName**: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `C:\SSIS\Checkpoints\MyPackage.chk`)
- **CheckpointUsage**: 
  - `Never` ‚Äî –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  - `IfExists` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –µ—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  - `Always` ‚Äî –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (—Ç—Ä–µ–±—É–µ—Ç —Ñ–∞–π–ª)
- **SaveCheckpoints**: `True` ‚Äî —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ

![](https://i.imgur.com/7XqQK4N.png)

### **2. –ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:**
- **–ö–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã** (–∏ –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç: Success/Failure)
- **–ó–Ω–∞—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö** –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–±–æ—è
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)

### **3. –ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ñ–∞–π–ª checkpoint:**
–≠—Ç–æ XML-—Ñ–∞–π–ª:
```xml
<DTS:Checkpoint xmlns:DTS="www.microsoft.com/SqlServer/Dts">
  <DTS:Variables>
    <DTS:Variable>
      <DTS:Property Name="Name">User::RowCount</DTS:Property>
      <DTS:Property Name="Value">150000</DTS:Property>
    </DTS:Variable>
  </DTS:Variables>
  <DTS:Tasks>
    <DTS:Task DTS:TaskName="Load Customers" DTS:Result="Success"/>
    <DTS:Task DTS:TaskName="Load Orders" DTS:Result="Failure"/> <!-- –£–ø–∞–ª–æ –∑–¥–µ—Å—å -->
  </DTS:Tasks>
</DTS:Checkpoint>
```

---

## **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä:**

### **–ü–∞–∫–µ—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:**
```
[–ó–∞–¥–∞—á–∞ 1: –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü] ‚Üí 
[–ó–∞–¥–∞—á–∞ 2: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤] ‚Üí 
[–ó–∞–¥–∞—á–∞ 3: –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤] ‚Üí 
[–ó–∞–¥–∞—á–∞ 4: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–æ–≤]
```

### **–°—Ü–µ–Ω–∞—Ä–∏–π —Å Checkpoints:**
1. **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫:** –í—Å–µ –∑–∞–¥–∞—á–∏ —É—Å–ø–µ—à–Ω—ã ‚Üí –§–∞–π–ª checkpoint —É–¥–∞–ª—è–µ—Ç—Å—è.
2. **–í—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫ (—Å–±–æ–π):**
   - –ó–∞–¥–∞—á–∞ 1: ‚úì –£—Å–ø–µ—Ö (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ checkpoint)
   - –ó–∞–¥–∞—á–∞ 2: ‚úì –£—Å–ø–µ—Ö (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ checkpoint) 
   - –ó–∞–¥–∞—á–∞ 3: ‚úó **–°–±–æ–π!** (–ø–∞–∫–µ—Ç –ø–∞–¥–∞–µ—Ç, checkpoint —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç, —á—Ç–æ –∑–∞–¥–∞—á–∞ 3 –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞)
   - –ó–∞–¥–∞—á–∞ 4: –ù–µ –∑–∞–ø—É—Å–∫–∞–ª–∞—Å—å
3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–∞–∫–µ—Ç–∞:**
   - SSIS —á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª `.chk`
   - –í–∏–¥–∏—Ç: "–ó–∞–¥–∞—á–∏ 1 –∏ 2 —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ"
   - **–ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á–∏ 1 –∏ 2!**
   - –ù–∞—á–∏–Ω–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ **—Å –∑–∞–¥–∞—á–∏ 3** (—Ç–æ–π, –∫–æ—Ç–æ—Ä–∞—è —É–ø–∞–ª–∞)
   - –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ 3 —Ç–µ–ø–µ—Ä—å —É—Å–ø–µ—à–Ω–∞ ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å –∑–∞–¥–∞—á–∏ 4

---

## **–ß—Ç–æ –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Checkpoint:**

### **‚ùå Data Flow Progress:**
**–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ!** –ï—Å–ª–∏ Data Flow Task –æ–±—Ä–∞–±–æ—Ç–∞–ª 1 –º–ª–Ω —Å—Ç—Ä–æ–∫ –∏–∑ 10 –º–ª–Ω –∏ —É–ø–∞–ª ‚Äî checkpoint **–ù–ï –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç** —ç—Ç—É –ø–æ–∑–∏—Ü–∏—é. –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ Data Flow Task –Ω–∞—á–Ω–µ—Ç **—Å –Ω–∞—á–∞–ª–∞**!

```sql
-- Data Flow Task —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π 10 –º–ª–Ω —Å—Ç—Ä–æ–∫:
-- –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 8 –º–ª–Ω, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ—á—Ç–∏ –∑–∞–∫–æ–Ω—á–µ–Ω–∞...
-- üí• –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–∞!
-- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫: Data Flow Task –Ω–∞—á–∏–Ω–∞–µ—Ç —Å 0 —Å—Ç—Ä–æ–∫, —Å–Ω–æ–≤–∞ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç 10 –º–ª–Ω
```

### **‚ùå –§–∞–π–ª–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**
–ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ "–§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞" —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∞ 100 –∏–∑ 1000 —Ñ–∞–π–ª–æ–≤ –∏ —É–ø–∞–ª–∞ ‚Äî checkpoint –Ω–µ –∑–∞–ø–æ–º–Ω–∏—Ç, –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ —Ñ–∞–π–ª—ã —É–∂–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã.

### **‚ùå –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ (Script Task):**
–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –Ω–æ –µ—Å–ª–∏ Script Task –≤—ã–ø–æ–ª–Ω—è–ª –¥–æ–ª–≥–∏–π —Ü–∏–∫–ª –∏ —É–ø–∞–ª –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–µ ‚Äî –æ–Ω –Ω–∞—á–Ω–µ—Ç —Å –Ω–∞—á–∞–ª–∞.

---

## **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á:**

–£ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ –µ—Å—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞:
- **FailPackageOnFailure**: –ü—Ä–∏ —Å–±–æ–µ –∑–∞–¥–∞—á–∏ –ø–∞–¥–∞–µ—Ç –≤–µ—Å—å –ø–∞–∫–µ—Ç (–¥–ª—è checkpoint –≤–∞–∂–Ω–æ)
- **FailParentOnFailure**: –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ
- **Disable**: –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ (–ø–æ checkpoint), –æ–Ω–∞ –±—É–¥–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω–∞ (—Å–µ—Ä—ã–º —Ü–≤–µ—Ç–æ–º) –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ

---

## **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–ª—è CDC:**

### **–°—Ü–µ–Ω–∞—Ä–∏–π: –î–æ–ª–≥–∞—è CDC-–∑–∞–≥—Ä—É–∑–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å**

```sql
–ü–∞–∫–µ—Ç CDC_Loader:
1. CDC Control Task (Get processing range)  -- –£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è checkpoint
2. Data Flow Task (–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π)      -- ‚ùå –ù–ï —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è checkpoint!
3. CDC Control Task (Mark processed range)   -- –£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è checkpoint
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ —É–ø–∞–¥–µ—Ç Data Flow Task (—à–∞–≥ 2), —Ç–æ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ:
- –®–∞–≥ 1 –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω)
- –®–∞–≥ 2 –Ω–∞—á–Ω–µ—Ç **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–Ω–æ–≤–æ** (–≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –Ω–∞—á–∞–ª–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞)
- –≠—Ç–æ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª–∏

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–±–∏—Ç—å –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ –ø–∞–∫–µ—Ç—ã –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

---

## **Checkpoints + –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ = –ú–æ—â–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è**

```sql
–ü–∞–∫–µ—Ç —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π –∏ checkpoint:
–ù–∞—á–∞–ª–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ –ó–∞–¥–∞—á–∞ 1: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞
‚îú‚îÄ‚îÄ –ó–∞–¥–∞—á–∞ 2: –ó–∞–≥—Ä—É–∑–∫–∞ –≤ staging
‚îú‚îÄ‚îÄ –ó–∞–¥–∞—á–∞ 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îî‚îÄ‚îÄ –ö–æ–Ω–µ—Ü —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

–°–±–æ–π –Ω–∞ –∑–∞–¥–∞—á–µ 3:
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è (–¥–∞–Ω–Ω—ã–µ –Ω–µ –∏—Å–ø–æ—Ä—á–µ–Ω—ã)
- Checkpoint —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç, —á—Ç–æ –∑–∞–¥–∞—á–∏ 1 –∏ 2 —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∑–∞–¥–∞—á–∏ 1 –∏ 2 –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
- –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∑–∞–¥–∞—á–∏ 3 —Å —á–∏—Å—Ç–æ–π staging-—Ç–∞–±–ª–∏—Ü–µ–π
```

---

## **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏:**

### **1. –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞:**
- –§–∞–π–ª checkpoint –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–≤—Ä–µ–∂–¥–µ–Ω
- –ù—É–∂–Ω—ã –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å/—á—Ç–µ–Ω–∏–µ
- –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –æ–±—â–µ–≥–æ –¥–∏—Å–∫–∞

### **2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∏–ø–∞ Object:**
–ù–µ —Å–µ—Ä–∏–∞–ª–∏–∑—É—é—Ç—Å—è –≤ checkpoint! –ï—Å–ª–∏ —É –≤–∞—Å –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `Object` —Å DataSet –∏–ª–∏ –¥—Ä—É–≥–∏–º –æ–±—ä–µ–∫—Ç–æ–º ‚Äî –æ–Ω–∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è.

### **3. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞:**
–ï—Å–ª–∏ –≤—ã –∏–∑–º–µ–Ω–∏–ª–∏ –ø–∞–∫–µ—Ç (–¥–æ–±–∞–≤–∏–ª–∏/—É–¥–∞–ª–∏–ª–∏ –∑–∞–¥–∞—á–∏), –∞ —Å—Ç–∞—Ä—ã–π checkpoint —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Äî **–±—É–¥–µ—Ç –æ—à–∏–±–∫–∞** –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

### **4. ForEach Loop / For Loop:**
Checkpoint —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç, —á—Ç–æ —Ü–∏–∫–ª –±—ã–ª –≤—ã–ø–æ–ª–Ω–µ–Ω, –Ω–æ **–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é**.

---

## **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Checkpoints:**

### **‚úÖ –•–æ—Ä–æ—à–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
- –î–æ–ª–≥–∏–µ Control Flow-–ø–∞–∫–µ—Ç—ã (–º–Ω–æ–≥–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á)
- –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–º–æ–≥—É—Ç –æ—Ç–≤–∞–ª–∏—Ç—å—Å—è)
- –ü–∞–∫–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ —á–∞—Å—Ç—è–º–∏
- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏, –≥–¥–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –Ω–∞—á–∞–ª–∞ –¥–æ—Ä–æ–≥

### **‚ùå –ü–ª–æ—Ö–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
- –ü–∞–∫–µ—Ç—ã —Å –æ–¥–Ω–∏–º –æ–≥—Ä–æ–º–Ω—ã–º Data Flow Task
- –ü–∞–∫–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º–∏ (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –Ω–∞—á–∞–ª–∞ –±–µ–∑–æ–ø–∞—Å–µ–Ω)
- –ö–æ–≥–¥–∞ –µ—Å—Ç—å —Ä–∏—Å–∫ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è checkpoint-—Ñ–∞–π–ª–∞
- –ü—Ä–∏ —á–∞—Å—Ç—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–∫–µ—Ç–∞

---

## **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã Checkpoints:**

### **1. –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Ç–æ—á–µ–∫:**
```sql
CREATE TABLE ETL_Checkpoints (
    PackageName NVARCHAR(100),
    CheckpointName NVARCHAR(100),
    LastValue SQL_VARIANT,
    LastRun DATETIME
)
-- –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü—É, –∞ –Ω–µ –≤ —Ñ–∞–π–ª
```

### **2. –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –ø–æ–¥–ø–∞–∫–µ—Ç—ã:**
```sql
–ì–ª–∞–≤–Ω—ã–π –ø–∞–∫–µ—Ç (Master.dtsx):
‚îú‚îÄ‚îÄ Execute Package: Load_Customers.dtsx
‚îú‚îÄ‚îÄ Execute Package: Load_Orders.dtsx
‚îî‚îÄ‚îÄ Execute Package: Load_Details.dtsx
-- –ö–∞–∂–¥—ã–π –ø–æ–¥–ø–∞–∫–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
```

### **3. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω:**
–°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç —Ç–∞–∫, —á—Ç–æ–±—ã –µ–≥–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—Å–µ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å –Ω–∞—á–∞–ª–∞ –±–µ–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.

---

## **–ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –¥–æ–ª–≥–æ–π –∑–∞–≥—Ä—É–∑–∫–∏:**

```sql
1. –°–≤–æ–π—Å—Ç–≤–∞ –ø–∞–∫–µ—Ç–∞:
   - CheckpointFileName: \\Server\Share\Checkpoints\LoadData.chk
   - CheckpointUsage: IfExists
   - SaveCheckpoints: True
   - TransactionOption: Supported

2. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–¥–∞—á:
   [Truncate Staging] -- FailPackageOnFailure = True
   [Load to Staging]  -- FailPackageOnFailure = True  
   [Transform Data]   -- FailPackageOnFailure = True
   [Load to Target]   -- FailPackageOnFailure = True

3. –ü—Ä–∏ —Å–±–æ–µ –Ω–∞ "Transform Data":
   - –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –ø–µ—Ä–≤—ã–µ –¥–≤–µ –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã
   - Staging-—Ç–∞–±–ª–∏—Ü–∞ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ (–Ω–µ truncate-–∏—Ç—Å—è!)
   - –ù–∞—á–∏–Ω–∞–µ–º —Å "Transform Data"
```

**–ü—Ä–æ–±–ª–µ–º–∞:** Staging-—Ç–∞–±–ª–∏—Ü–∞ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã —á–∞—Å—Ç–∏—á–Ω–æ. –ù—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞.

---

## **–í—ã–≤–æ–¥:**

Checkpoints ‚Äî —ç—Ç–æ **—Å–∫–æ—Ä–µ–µ "–∞–≤–∞—Ä–∏–π–Ω—ã–π —Ç–æ—Ä–º–æ–∑", —á–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏**. –û–Ω–∏ —Ö–æ—Ä–æ—à–∏ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ **—Ä–µ–¥–∫–∏—Ö —Å–±–æ–µ–≤** –≤ –¥–æ–ª–≥–∏—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö, –Ω–æ:

1. **–ù–µ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è Data Flow –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**
2. **–¢—Ä–µ–±—É—é—Ç –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞ –ø–∞–∫–µ—Ç–∞**
3. **–ú–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** (—á–∞—Å—Ç–∏—á–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

**–õ—É—á—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞:** –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–π—Ç–µ –ø–∞–∫–µ—Ç—ã –∫–∞–∫ **–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ + —Ä–∞–∑–±–∏—Ç—ã–µ –Ω–∞ —Ñ–∞–∑—ã**, –∞ checkpoints –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω—é—é –ª–∏–Ω–∏—é –æ–±–æ—Ä–æ–Ω—ã –¥–ª—è –æ—á–µ–Ω—å –¥–æ–ª–≥–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –≥–¥–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –Ω–∞—á–∞–ª–∞ —Å–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥.
